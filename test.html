<!DOCTYPE html>
<html>
<head>
    <script src="bundle.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCL1J1qRPLGfBP9AkMp9E0zfD-5_5UZcWs&callback=getLocationUpdate"> </script>
      <script type="text/javascript">
        var watchID,geoLoc,target;
        var flag = false; 
        target = {latitude:1.379155,longitude:103.849828};

        function success(position) {
            var origin_lat = position.coords.latitude;
            var origin_lng = position.coords.longitude;
            const map = window.map
            document.getElementById("recenter").addEventListener("click", () => {
                var latlng = new google.maps.LatLng(origin_lat,origin_lng)
                map.setCenter(latlng,18)
            })
            if (target.latitude === origin_lat && target.longitude === crd.longitude){
                navigator.geolocation.clearWatch(watchID)
            } else{
                const directionsService = new google.maps.DirectionsService();
                const directionRenderer = new google.maps.DirectionsRenderer({preserveViewport:true});
                
                directionRenderer.setMap(map);
                if (flag==true){
                    directionsService.route({
                            origin : {lat:origin_lat, lng:origin_lng},
                            destination : {lat:1.379155,lng:103.849828},
                            waypoints: [
                                {location:{lat:1.380062,lng:103.848594}}
                            ],
                            optimizeWaypoints: true,
                            travelMode: google.maps.TravelMode.WALKING
                        }) .then((response)=>{
                            directionRenderer.setDirections(response);
                            const route = response.routes[0];
                            const summaryPanel = document.getElementById("directions-panel")
                            summaryPanel.innerHTML="";

                            //For each route, display information
                            for (let i = 0; i < route.legs.length; i++) {
                                const routeSegment = i + 1;

                                summaryPanel.innerHTML +=
                                "<b>Route Segment: " + routeSegment + "</b><br>";
                                summaryPanel.innerHTML += route.legs[i].start_address + " to ";
                                summaryPanel.innerHTML += route.legs[i].end_address + "<br>";
                                summaryPanel.innerHTML += route.legs[i].distance.text + "<br><br>";
                            }
                        })
                // If button is not clicked before
                } else{
                    document.getElementById("submit").addEventListener("click", () => {
                        flag = true
                        directionsService.route({
                            origin : {lat:origin_lat, lng:origin_lng},
                            destination : "Nanyang Polytechnic Block L,180 Ang Mo Kio Ave 8,Singapore 569830",
                            waypoints: [
                                {location:{lat:1.380062,lng:103.848457}}
                            ],
                            optimizeWaypoints: true,
                            travelMode: google.maps.TravelMode.WALKING
                        }) .then((response)=>{
                            directionRenderer.setDirections(response);
                            const route = response.routes[0];
                            const summaryPanel = document.getElementById("directions-panel")
                            summaryPanel.innerHTML="";

                            //For each route, display information
                            for (let i = 0; i < route.legs.length; i++) {
                                const routeSegment = i + 1;

                                summaryPanel.innerHTML +=
                                "<b>Route Segment: " + routeSegment + "</b><br>";
                                summaryPanel.innerHTML += route.legs[i].start_address + " to ";
                                summaryPanel.innerHTML += route.legs[i].end_address + "<br>";
                                summaryPanel.innerHTML += route.legs[i].distance.text + "<br><br>";
                            }
                        })
                    }); 
                }
            }
         }
         function errorHandler(err) {
            if(err.code == 1) {
               alert("Error: Access is denied!");
            } else if( err.code == 2) {
               alert("Error: Position is unavailable!");
            }
         }
        function getLocationUpdate(){
            if (navigator.geolocation){
                geoLoc = navigator.geolocation
                // Get current positon 
                var options = {
                    enableHighAccuracy: true,
                    maximumAge: 0
                };
                geoLoc.getCurrentPosition(currentPositionSuccess,currentPositionError,options)
                
                 // timeout  in 60 seconds
                var options = {timeout:60000};
                
                // Watch position 
                watchID = geoLoc.watchPosition(success,errorHandler,options)
            } else{
                alert("Browser does not support geolocation!")
            }
        }
        function currentPositionSuccess(position){
            origin_lat = position.coords.latitude;
            origin_lng = position.coords.longitude
            window.map = new google.maps.Map(document.getElementById("map"), {
                zoom: 18,
                center: { lat: origin_lat, lng: origin_lng },
                zoomControl: false,
            });
        }
        function currentPositionError(err){
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }
        
        
    </script>
    <style>
        #map {
          height: 100%;
        }
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }
      </style>
</head>
<body>

<button id="submit"> GET YOUR ROUTE</button>
<button id ="recenter">RECENTER</button>
<div id="map"></div>
<div id="directions-panel"></div>
</body>
</html>